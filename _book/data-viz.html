<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="David Keyes">
<title>R for the Rest of Us: A Statistics-Free Introduction - 2&nbsp; Principles of Data Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./custom-theme.html" rel="next">
<link href="./crash-course.html" rel="prev">
<link href="./assets/cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdn.usefathom.com/script.js" data-site="JNTNGGFP" defer=""></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./crash-course.html">Part I: Visualizations</a></li><li class="breadcrumb-item"><a href="./data-viz.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Principles of Data Visualization</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for the Rest of Us: A Statistics-Free Introduction</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Part I: Visualizations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./crash-course.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An R Programming Crash Course</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-viz.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Principles of Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./custom-theme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Custom Data Visualization Themes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Maps and Geospatial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Designing Effective Tables</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part II: Reports, Presentations, and Websites</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R Markdown Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parameterized-reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Parameterized Reporting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Slideshow Presentations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./websites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Websites</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part III: Automation and Collaboration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Automatically Accesing Online Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Creating Functions and Packages</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#the-drought-visualization" id="toc-the-drought-visualization" class="nav-link active" data-scroll-target="#the-drought-visualization">The Drought Visualization</a></li>
  <li><a href="#the-grammar-of-graphics" id="toc-the-grammar-of-graphics" class="nav-link" data-scroll-target="#the-grammar-of-graphics">The Grammar of Graphics</a></li>
  <li>
<a href="#working-with-ggplot2" id="toc-working-with-ggplot2" class="nav-link" data-scroll-target="#working-with-ggplot2">Working With ggplot2</a>
  <ul class="collapse">
<li><a href="#the-first-layer-mapping-data-to-aesthetic-properties" id="toc-the-first-layer-mapping-data-to-aesthetic-properties" class="nav-link" data-scroll-target="#the-first-layer-mapping-data-to-aesthetic-properties">The First Layer: Mapping Data to Aesthetic Properties</a></li>
  <li><a href="#the-second-layer-choosing-the-geoms" id="toc-the-second-layer-choosing-the-geoms" class="nav-link" data-scroll-target="#the-second-layer-choosing-the-geoms">The Second Layer: Choosing the geoms</a></li>
  <li><a href="#the-third-layer-altering-aesthetic-properties" id="toc-the-third-layer-altering-aesthetic-properties" class="nav-link" data-scroll-target="#the-third-layer-altering-aesthetic-properties">The Third Layer: Altering Aesthetic Properties</a></li>
  <li><a href="#the-fourth-layer-setting-a-theme" id="toc-the-fourth-layer-setting-a-theme" class="nav-link" data-scroll-target="#the-fourth-layer-setting-a-theme">The Fourth Layer: Setting a Theme</a></li>
  </ul>
</li>
  <li>
<a href="#recreating-the-drought-visualization-with-ggplot" id="toc-recreating-the-drought-visualization-with-ggplot" class="nav-link" data-scroll-target="#recreating-the-drought-visualization-with-ggplot">Recreating the Drought Visualization with ggplot</a>
  <ul class="collapse">
<li><a href="#plotting-one-region-and-year" id="toc-plotting-one-region-and-year" class="nav-link" data-scroll-target="#plotting-one-region-and-year">Plotting One Region and Year</a></li>
  <li><a href="#changing-aesthetic-properties" id="toc-changing-aesthetic-properties" class="nav-link" data-scroll-target="#changing-aesthetic-properties">Changing Aesthetic Properties</a></li>
  <li><a href="#faceting-the-plot" id="toc-faceting-the-plot" class="nav-link" data-scroll-target="#faceting-the-plot">Faceting the Plot</a></li>
  <li><a href="#applying-small-polishes" id="toc-applying-small-polishes" class="nav-link" data-scroll-target="#applying-small-polishes">Applying Small Polishes</a></li>
  <li><a href="#the-complete-visualization-code" id="toc-the-complete-visualization-code" class="nav-link" data-scroll-target="#the-complete-visualization-code">The Complete Visualization Code</a></li>
  </ul>
</li>
  <li><a href="#in-conclusion-ggplot-is-your-data-visualization-secret-weapon" id="toc-in-conclusion-ggplot-is-your-data-visualization-secret-weapon" class="nav-link" data-scroll-target="#in-conclusion-ggplot-is-your-data-visualization-secret-weapon">In Conclusion: ggplot is Your Data Visualization Secret Weapon</a></li>
  <li><a href="#learn-more" id="toc-learn-more" class="nav-link" data-scroll-target="#learn-more">Learn More</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./crash-course.html">Part I: Visualizations</a></li><li class="breadcrumb-item"><a href="./data-viz.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Principles of Data Visualization</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-data-viz-chapter" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Principles of Data Visualization</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><p>In the spring of 2021, nearly all of the American West was in a drought. By April of that year, officials in Southern California had declared a water emergency, citing unprecedented conditions.</p>
<p>This wouldn’t have come as news to those living in California and other Western states. Drought conditions like those in the West in 2021 are becoming increasingly common. Yet communicating the extent of problem remains difficult. How can we show the data in a way that accurately represents it while making it compelling enough to get people to take notice?</p>
<p>Data-visualization designers Cédric Scherer and Georgios Karamanis took on this challenge in the fall of 2021. By working with the magazine <em>Scientific American</em> to create a data visualization of drought conditions over the last two decades in the United States, they turned to the <code>ggplot2</code> package to transform what could have been dry data (pardon the pun) into a visually arresting and impactful graph.</p>
<p>This chapter explores why the data visualization that Scherer and Karamanis created is effective and introduces you to the <em>grammar of graphics</em>, a theory to make sense of graphs that underlies the <code>ggplot2</code> package. You’ll then learn how to use <code>ggplot2</code> by recreating the drought graph step by step. In the process, we’ll highlight some key principles of high-quality data visualization that you can use to improve your own work.</p>
<section id="the-drought-visualization" class="level2"><h2 class="anchored" data-anchor-id="the-drought-visualization">The Drought Visualization</h2>
<p>Other news organizations had relied on the same data as Scherer and Karamanis, from the National Drought Center, in their stories. But Scherer and Karamanis visualized it in a way that it both grabs attention and communicates the scale of the phenomenon. <a href="#fig-final-viz" class="quarto-xref">Figure&nbsp;<span>2.1</span></a> shows a section of the final visualization. Covering four regions over the last two decades, the graph makes apparent increase in drought conditions, especially in California and the Southwest.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-final-viz" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-final-viz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-final-viz-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-final-viz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: A section of the final drought visualization, with a few tweaks made so that the plots fit in this book
</figcaption></figure>
</div>
</div>
</div>
<p>To understand why this visualization is effective, let’s break it down into pieces. At the broadest level, the data visualization is notable for its minimalist aesthetic. There are, for example, no grid lines and few text labels, as well as little text along the axes. Scherer and Karamanis removed what statistician Edward Tufte, in his 1983 book <em>The Visual Display of Quantitative Information</em>, calls <em>chartjunk</em>. Tufte wrote that extraneous elements often hinder, rather than help, our understanding of charts (and researchers, as well as data visualization designers since, have generally agreed).</p>
<p>Need proof that Scherer and Karamanis’s decluttered graph is better than the alternative? <a href="#fig-cluttered-viz" class="quarto-xref">Figure&nbsp;<span>2.2</span></a> shows a version with a few small tweaks to the code to include grid lines and text labels on axes. Prepare yourself for clutter!</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-cluttered-viz" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cluttered-viz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-cluttered-viz-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cluttered-viz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: The cluttered version of the drought visualization
</figcaption></figure>
</div>
</div>
</div>
<p>Again, it’s not just that this cluttered version looks worse. The clutter actively inhibits understanding. Rather than focus on overall drought patterns (the point of the graph), our brain gets stuck reading repetitive and unnecessary axis text.</p>
<p>One of the best ways to reduce clutter is to break a single chart into what are known as <em>small multiples</em>. When we look closely at the data visualization, we see that it is not one chart but actually a set of charts. Each rectangle represents one region in one year. If we filter it to show the Southwest region in 2003 and add axis titles, we can see in <a href="#fig-viz-sw-2003" class="quarto-xref">Figure&nbsp;<span>2.3</span></a> that the x axis shows the week while the y axis shows the percentage of that region at different drought levels.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-viz-sw-2003" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-viz-sw-2003-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-viz-sw-2003-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-viz-sw-2003-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: A drought visualization for the Southwest in 2003
</figcaption></figure>
</div>
</div>
</div>
<p>Zooming in on a single region in a single year also makes the color choices more obvious. The lightest bars show the percentage of the region that is abnormally dry while the darkest bars show the percentage in exceptional drought conditions. These colors, as we’ll see shortly, were intentionally chosen to make differences in the drought levels visible to all readers. Even so, the R code that Scherer and Karamanis wrote to produce this complex graph is relatively simple, due largely to a theory called the grammar of graphics.</p>
</section><section id="the-grammar-of-graphics" class="level2"><h2 class="anchored" data-anchor-id="the-grammar-of-graphics">The Grammar of Graphics</h2>
<p>If you’ve used Excel to make graphs, you’re probably familiar with the menu shown in <a href="#fig-excel-chart-chooser" class="quarto-xref">Figure&nbsp;<span>2.4</span></a>. When working in Excel, your graph-making journey begins by selecting the type of graph you want to make. Want a bar chart? Click the bar chart icon. Want a line chart? Click the line chart icon.</p>
<div id="fig-excel-chart-chooser" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-excel-chart-chooser-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/excel-chart-chooser.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-excel-chart-chooser-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: The Excel chart chooser menu
</figcaption></figure>
</div>
<p>If you’ve only ever made data visualization in Excel, this first step may seem so obvious that you’ve never even considered the process of creating data visualization in any other way. But there are different models for thinking about graphs. Rather than conceptualizing graphs types as being distinct, we can recognize the things that they have in common and use these commonalities as the starting point for making them.</p>
<p>This approach to thinking about graphs comes from the late statistician Leland Wilkinson. For years, Wilkinson thought deeply about what data visualization is and how we can describe it. In 1999, he published a book called <em>The Grammar of Graphics</em> that sought to develop a consistent way of describing all graphs. In it, Wilkinson argued that we should think of plots not as distinct types à la Excel, but as following a grammar that we can use to describe <em>any</em> plot. Just as English grammar tells us that a noun is typically followed by a verb (which is why “he goes” works, while the opposite, “goes he,” does not), knowledge of the grammar of graphics allows us to understand why certain graph types “work.”</p>
<p>Thinking about data visualization through the lens of the grammar of graphics allow us to see, for example, that graphs typically have some data that is plotted on the x axis and other data that is plotted on the y axis. This is the case no matter whether the graph is a bar chart or a line chart, for example. Consider <a href="#fig-bar-line-chart" class="quarto-xref">Figure&nbsp;<span>2.5</span></a>, which shows two charts that use identical data on life expectancy in Afghanistan.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-bar-line-chart" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-bar-line-chart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-bar-line-chart-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bar-line-chart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: A bar chart and a line chart showing identical data on Afghanistan life expectancy
</figcaption></figure>
</div>
</div>
</div>
<p>While they look different (and would, to the Excel user, be different types of graphs), Wilkinson’s grammar of graphics allows us to see their similarities. (Incidentally, Wilkinson’s feelings on graph-making tools like Excel became clear when he wrote that “most charting packages channel user requests into a rigid array of chart types.”)</p>
<p>When Wilkinson wrote his book, no data visualization tool could implement his grammar of graphics. This would change in 2010, when Hadley Wickham announced the <code>ggplot2</code> package for R in an article titled “A Layered Grammar of Graphics.” By providing the tools to implement Wilkinson’s ideas, <code>ggplot2</code> would come to revolutionize the world of data visualization.</p>
</section><section id="working-with-ggplot2" class="level2"><h2 class="anchored" data-anchor-id="working-with-ggplot2">Working With ggplot2</h2>
<p>The <code>ggplot2</code> R package (which I, like nearly everyone in the data visualization world, will refer to simply as ggplot) relies on the idea of plots having multiple layers. Let’s walk through some of the most important ones. We’ll begin by selecting variables to map to aesthetic properties. Then we’ll choose a geometric object to use to represent our data. Next, we’ll change the aesthetic properties of our chart (its color scheme, for example) using a <code>scale_</code> function. Finally, we’ll use a <code>theme_</code> function to set the overall look-and-feel of our plot.</p>
<section id="the-first-layer-mapping-data-to-aesthetic-properties" class="level3"><h3 class="anchored" data-anchor-id="the-first-layer-mapping-data-to-aesthetic-properties">The First Layer: Mapping Data to Aesthetic Properties</h3>
<p>When creating a graph with ggplot, we begin by mapping data to aesthetic properties. All this really means is that we use things like the x or y axis, color, and size (the so-called <em>aesthetic properties</em>) to represent variables. To make this concrete, we’ll use the data on life expectancy in Afghanistan, introduced in the previous section, to generate a plot. Access this data with the following code:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gapminder_10_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://data.rwithoutstatistics.com/gapminder_10_rows.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s what the <code>gapminder_10_rows</code> data frame looks like:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.</code></pre>
</div>
</div>
<p>This is a shortened version of the full gapminder data frame, which includes over 1,700 rows of data.</p>
<p>If we want to make a chart with ggplot, we need to first decide which variable to put on the x axis and which to put on the y axis. For data showing change over time, it is common to put the date on the x axis and the value of what you are showing on the y axis. That means we would use the variable <code>year</code> on the x axis and the variable <code>lifeExp</code> on the y axis. To do so, we begin by using the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Within this function, we tell R that we’re using the data frame <code>gapminder_10_rows</code>. We also map <code>year</code> to the x axis and <code>lifeExp</code> to the y axis.</p>
<p>When we run the code, what we get in <a href="#fig-blank-ggplot" class="quarto-xref">Figure&nbsp;<span>2.6</span></a> doesn’t look like much.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-blank-ggplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-blank-ggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-blank-ggplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-blank-ggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.6: A blank chart
</figcaption></figure>
</div>
</div>
</div>
<p>If you look closely, however, you should see that the x axis corresponds to <code>year</code> and the y axis corresponds to <code>lifeExp</code>. Also, the values on the x and y axes match the scope of our data. In the <code>gapminder_10_rows</code> data frame, the first year is 1952 and the last year is 1997. The range of the x axis seems to have been created with this data in mind (because it was). Likewise, <code>lifeExp</code>, which goes from about 28 to about 42, will fit nicely on our y axis.</p>
</section><section id="the-second-layer-choosing-the-geoms" class="level3"><h3 class="anchored" data-anchor-id="the-second-layer-choosing-the-geoms">The Second Layer: Choosing the geoms</h3>
<p>Axes are nice, but we’re missing any type of visual representation of the data. To get this, we need to add the next ggplot layer: geoms. Short for <em>geometric objects</em>, <em>geoms</em> are functions that provide different ways of representing data. For example, if we want to add points to the graph, we use <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, in <a href="#fig-gapminder-points-plot" class="quarto-xref">Figure&nbsp;<span>2.7</span></a>, we see that people in 1952 had a life expectancy of about 28 and that this value rose every year included in the data.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gapminder-points-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gapminder-points-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-gapminder-points-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gapminder-points-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.7: The same chart but with points added
</figcaption></figure>
</div>
</div>
</div>
<p>Let’s say we change our mind and want to make a line chart instead. All we have to do is replace <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> with <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-gapminder-line-plot" class="quarto-xref">Figure&nbsp;<span>2.8</span></a> shows the result.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gapminder-line-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gapminder-line-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-gapminder-line-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gapminder-line-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.8: The data as a line chart
</figcaption></figure>
</div>
</div>
</div>
<p>To really get fancy, what if we add both <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code>?</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code generates a line chart with points, as shown in <a href="#fig-gapminder-points-line-plot" class="quarto-xref">Figure&nbsp;<span>2.9</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gapminder-points-line-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gapminder-points-line-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-gapminder-points-line-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gapminder-points-line-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.9: The data with points and a line
</figcaption></figure>
</div>
</div>
</div>
<p>We can swap in <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> to create a bar chart:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note in <a href="#fig-gapminder-bar-plot" class="quarto-xref">Figure&nbsp;<span>2.10</span></a> that the y axis range has been automatically updated, going from 0 to 40 to account for the different geom.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gapminder-bar-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gapminder-bar-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-gapminder-bar-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gapminder-bar-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.10: The data as a bar chart
</figcaption></figure>
</div>
</div>
</div>
<p>As you can see, the difference between a line chart and a bar chart isn’t as great as the Excel chart-type picker might have us think. Both can have the same underlying properties (namely, putting years on the x axis and life expectancies on the y axis). They simply use different geometric objects to visually represent the data.</p>
</section><section id="the-third-layer-altering-aesthetic-properties" class="level3"><h3 class="anchored" data-anchor-id="the-third-layer-altering-aesthetic-properties">The Third Layer: Altering Aesthetic Properties</h3>
<p>Before we return to the drought data visualization, let’s look at a few additional layers that can help us can alter the bar chart. Say we want to change the color of the bars. In the grammar of graphics approach to chart-making, this means mapping some variable to the aesthetic property of <code>fill</code>. (Slightly confusingly, the aesthetic property of <code>color</code> would, for a bar chart, change only the outline of each bar). In the same way that we mapped <code>year</code> to the x axis and <code>lifeExp</code> to the y axis, we can map <code>fill</code> to a variable, such as <code>year</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">year</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-gapminder-bar-colors-plot" class="quarto-xref">Figure&nbsp;<span>2.11</span></a> shows the result. We see now that, for earlier years, the fill is darker, while for later years, it is lighter (the legend, added to the right of our plot, also indicates this).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gapminder-bar-colors-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gapminder-bar-colors-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-gapminder-bar-colors-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gapminder-bar-colors-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.11: The same chart, now with added colors
</figcaption></figure>
</div>
</div>
</div>
<p>What if we wanted to change the fill colors? For that, we use a new scale layer. To do this, I’ll use the <code><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c()</a></code> function. The <em>c</em> at the end of the function name refers to the fact that the data is continuous, meaning it can take any numeric value:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">year</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function changes the default palette to one that is colorblind-friendly and prints well in grayscale. The <code><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c()</a></code> function is just one of many that start with <code>scale_</code> and can alter the fill scale.</p>
</section><section id="the-fourth-layer-setting-a-theme" class="level3"><h3 class="anchored" data-anchor-id="the-fourth-layer-setting-a-theme">The Fourth Layer: Setting a Theme</h3>
<p>A final layer we’ll look at is the theme layer. This layer allows us to change the overall look-and-feel of plots (including the plot background, grid lines, and so on). Just as there are a number of <code>scale_</code> functions, there are also a number of functions that start with <code>theme_</code>. Here, we’ve added <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">gapminder_10_rows</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">year</span>,</span>
<span>    y <span class="op">=</span> <span class="va">lifeExp</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">year</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice in <a href="#fig-gapminder-theme-plot" class="quarto-xref">Figure&nbsp;<span>2.12</span></a> that this theme starts to declutter the plot.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gapminder-theme-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gapminder-theme-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-gapminder-theme-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gapminder-theme-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.12: The same chart with <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code> added
</figcaption></figure>
</div>
</div>
</div>
<p>By now, you should see why Hadley Wickham described the <code>ggplot2</code> package as using a layered grammar of graphics. It implements Wilkinson’s theory through the creation of multiple layers. First, we select variables to map to aesthetic properties, such as x or y axes, color, and fill. Second, we choose the geometric object (or geom) we want to use to represent our data. Third, if we want to change aesthetic properties (for example, to use a different color palette), we do this with a <code>scale_</code> function. Fourth, we use a <code>theme_</code> function to set the overall look-and-feel of the plot.</p>
<p>We could improve the plot we’ve been working on in many ways, but rather than add to an ugly plot, let’s instead return to the drought data visualization by Cédric Scherer and Georgios Karamanis. By walking through their code, you’ll learn lessons about making high-quality data visualization with ggplot and R.</p>
</section></section><section id="recreating-the-drought-visualization-with-ggplot" class="level2"><h2 class="anchored" data-anchor-id="recreating-the-drought-visualization-with-ggplot">Recreating the Drought Visualization with ggplot</h2>
<p>fundamentals and some less-well-known tweaks that make it really shine. To understand how Scherer and Karamanis made their data visualization, we’ll start with a simplified version of their code, then build it up layer by layer, adding elements as we go.</p>
<p>First, let’s import the data. Scherer and Karamanis do this with the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the <code>rio</code> package:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gesistsa/rio">rio</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dm_perc_cat_hubs_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://data.rwithoutstatistics.com/dm_export_20000101_20210909_perc_cat_hubs.json"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function is helpful because the data they are working with is in JSON format, which can be complicated to work with. The <code>rio</code> package simplifies it into just one line.</p>
<section id="plotting-one-region-and-year" class="level3"><h3 class="anchored" data-anchor-id="plotting-one-region-and-year">Plotting One Region and Year</h3>
<p>Let’s start by looking at just one region (the Southwest) in one year (2003). First, we filter our data and save it as a new object called <code>southwest_2003</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">southwest_2003</span> <span class="op">&lt;-</span> <span class="va">dm_perc_cat_hubs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hub</span> <span class="op">==</span> <span class="st">"Southwest"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2003</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can take a look at this object to see the variables we have to work with by typing <code>southwest_2003</code> in the console, which will return this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 255 × 7
   date       hub       category percentage  year  week max_week
   &lt;date&gt;     &lt;fct&gt;     &lt;fct&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1 2003-12-30 Southwest D0           0.0718  2003    52       52
 2 2003-12-30 Southwest D1           0.0828  2003    52       52
 3 2003-12-30 Southwest D2           0.269   2003    52       52
 4 2003-12-30 Southwest D3           0.311   2003    52       52
 5 2003-12-30 Southwest D4           0.0796  2003    52       52
 6 2003-12-23 Southwest D0           0.0823  2003    51       52
 7 2003-12-23 Southwest D1           0.131   2003    51       52
 8 2003-12-23 Southwest D2           0.189   2003    51       52
 9 2003-12-23 Southwest D3           0.382   2003    51       52
10 2003-12-23 Southwest D4           0.0828  2003    51       52
# ℹ 245 more rows</code></pre>
</div>
</div>
<p>The <code>date</code> variable represents the start date of the week in which the observation took place. The <code>hub</code> variable is the region, and <code>category</code> is the level of drought: a value of <code>D0</code> indicates the lowest level of drought, while <code>D5</code> indicates the highest level. The <code>percentage</code> variable is the percentage of that region in that drought category, ranging from <code>0</code> to <code>1</code>. The <code>year</code> and <code>week</code> variables are the observation year and week number (beginning with week 1). The <code>max_week</code> variable is the maximum number of weeks in a given year.</p>
<p>Now we can use this <code>southwest_2003</code> object for our plotting:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">southwest_2003</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">week</span>,</span>
<span>    y <span class="op">=</span> <span class="va">percentage</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">category</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function, we tell R to put <code>week</code> on the x axis and <code>percentage</code> on the y axis. We also use the <code>category</code> variable for the <code>fill</code> color. We then use <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> to create a bar chart in which the <code>fill</code> color of each bar represents the percentage of the region in a single week at each drought level. You can see the result in in <a href="#fig-southwest-2003-no-style-plot" class="quarto-xref">Figure&nbsp;<span>2.13</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-southwest-2003-no-style-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-southwest-2003-no-style-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-southwest-2003-no-style-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-southwest-2003-no-style-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.13: One year and region of the drought visualization
</figcaption></figure>
</div>
</div>
</div>
<p>The colors don’t match the final version of the plot, but we can start to see the outlines of Scherer and Karamanis’s data visualization.</p>
</section><section id="changing-aesthetic-properties" class="level3"><h3 class="anchored" data-anchor-id="changing-aesthetic-properties">Changing Aesthetic Properties</h3>
<p>Scherer and Karamanis next selected different <code>fill</code> colors for their bars. To do so, they used the <code><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d()</a></code> function. The <em>d</em> here means that the data to which the fill scale is being applied has discrete categories, called D0, D1, D2, D3, D4, and D5:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">southwest_2003</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">week</span>,</span>
<span>    y <span class="op">=</span> <span class="va">percentage</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">category</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span></span>
<span>    option <span class="op">=</span> <span class="st">"rocket"</span>,</span>
<span>    direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>They used the argument <code>option = "rocket"</code> to select the rocket palette (the function has several other palettes). Then they used the <code>direction = -1</code> argument to reverse the order of fill colors so that darker colors mean higher drought conditions.</p>
<p>Scherer and Karamanis also tweaked the appearance of the x and y axes:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">southwest_2003</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">week</span>,</span>
<span>    y <span class="op">=</span> <span class="va">percentage</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">category</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span></span>
<span>    option <span class="op">=</span> <span class="st">"rocket"</span>,</span>
<span>    direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    guide <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"right"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On the x axis, they removed both the axis title (“week”) using <code>name = NULL</code> and the 0–50 text with <code>guide = "none"</code>. On the y axis, they removed the title and text showing percentages using <code>labels = NULL</code>, which functionally does the same thing as <code>guide = "none"</code>. They also moved the axis lines themselves to the right side using <code>position = "right"</code>. These axis lines are apparent only as tick marks at this point but will become more visible later. <a href="#fig-southwest-2003-xy-scales-plot" class="quarto-xref">Figure&nbsp;<span>2.14</span></a> shows the result of these tweaks.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-southwest-2003-xy-scales-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-southwest-2003-xy-scales-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-southwest-2003-xy-scales-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-southwest-2003-xy-scales-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.14: One year and region of the drought visualization with adjustments to the x and y axes
</figcaption></figure>
</div>
</div>
</div>
<p>Up to this point, we’ve focused on one of the single plots that make up the larger data visualization. But the final product that Scherer and Karamanis made is actually 176 plots visualizing 22 years and eight regions. Let’s discuss the ggplot feature they used to create all of these plots.</p>
</section><section id="faceting-the-plot" class="level3"><h3 class="anchored" data-anchor-id="faceting-the-plot">Faceting the Plot</h3>
<p>One of the most useful features of ggplot is what’s known as <em>faceting</em> (or, more commonly in the data visualization world, small multiples). Faceting takes a single plot and makes it into multiple plots using a variable. For example, think of a line chart showing life expectancy by country over time; instead of multiple lines on one plot, we might create multiple plots with one line per plot). With the <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> function, we can select which variable to put in the rows and which to put in the columns of our faceted plot:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dm_perc_cat_hubs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hub</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Northwest"</span>,</span>
<span>    <span class="st">"California"</span>,</span>
<span>    <span class="st">"Southwest"</span>,</span>
<span>    <span class="st">"Northern Plains"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">week</span>,</span>
<span>    y <span class="op">=</span> <span class="va">percentage</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">category</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span></span>
<span>    option <span class="op">=</span> <span class="st">"rocket"</span>,</span>
<span>    direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    guide <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"right"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span></span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">hub</span><span class="op">)</span>,</span>
<span>    switch <span class="op">=</span> <span class="st">"y"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Scherer and Karamanis put <code>year</code> in rows and <code>hub</code> (region) in columns. The <code>switch = "y"</code> argument moves the year label from the right side (where it appears by default) to the left. With this code in place, we can see the final plot coming together in <a href="#fig-drought-viz-faceted-plot" class="quarto-xref">Figure&nbsp;<span>2.15</span></a>. Space considerations require me to include only four regions, but you get the idea.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-drought-viz-faceted-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-drought-viz-faceted-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-drought-viz-faceted-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-drought-viz-faceted-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.15: The faceted version of the drought visualization. Space considerations require me to include only four regions, but you get the idea.
</figcaption></figure>
</div>
</div>
</div>
<p>Incredibly, the broad outlines of the plot took us just 10 lines to create. The rest of the code falls into the category of small polishes. That’s not to minimize how important small polishes are (very) or the time it takes to create them (lots). It does show, however, that a little bit of ggplot goes a long way.</p>
</section><section id="applying-small-polishes" class="level3"><h3 class="anchored" data-anchor-id="applying-small-polishes">Applying Small Polishes</h3>
<p>Let’s look at a few of the small polishes that Scherer and Karamanis made. The first is to apply a theme, as shown in <a href="#fig-drought-viz-theme-tweaks-plot" class="quarto-xref">Figure&nbsp;<span>2.16</span></a>. They used <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light()</a></code>, which removes the default gray background and changes the font to Roboto.</p>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light()</a></code> function is what’s known as a <em>complete theme</em>. So-called complete themes change the overall look-and-feel of a plot. But Scherer and Karamanis didn’t stop there. They then used the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> function to make additional tweaks to what <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light()</a></code> gave them:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dm_perc_cat_hubs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hub</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Northwest"</span>,</span>
<span>    <span class="st">"California"</span>,</span>
<span>    <span class="st">"Southwest"</span>,</span>
<span>    <span class="st">"Northern Plains"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">week</span>,</span>
<span>    y <span class="op">=</span> <span class="va">percentage</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">category</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      xmax <span class="op">=</span> <span class="va">max_week</span> <span class="op">+</span> <span class="fl">.5</span>,</span>
<span>      ymin <span class="op">=</span> <span class="op">-</span><span class="fl">0.005</span>,</span>
<span>      ymax <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#f4f4f9"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.4</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span></span>
<span>    option <span class="op">=</span> <span class="st">"rocket"</span>,</span>
<span>    direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    guide <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"right"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span></span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">hub</span><span class="op">)</span>,</span>
<span>    switch <span class="op">=</span> <span class="st">"y"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Roboto"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      family <span class="op">=</span> <span class="st">"Roboto Mono"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">11</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">.2</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">.2</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.ticks.length.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"#2DAADA"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#2DAADA"</span><span class="op">)</span>,</span>
<span>    strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">20</span>, b <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.y.left <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.spacing.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    panel.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span>,</span>
<span>    plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">.4</span></span>
<span>    <span class="op">)</span>,</span>
<span>    plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code in the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> function does many different things, but let’s take a look at a few of the most important. First, it moves the legend from the right side (the default) to the top of the plot. Then, an <code>angle = 0</code> argument rotates the year text in the columns so that it is no longer angled. Without this argument, the years would be much less readable.</p>
<p>Next, the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> function makes the distinctive axis lines and ticks that show up on the right side of the final plot. Calling <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> removes all grid lines. Finally, three lines remove the borders and make each of the individual plots have a transparent background.</p>
<p>Keen readers such as yourself may now be thinking, “Wait. Didn’t the individual plots have a gray background behind them?” Yes, dear reader, they did. Scherer and Karamanis made these with a separate geom, <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>    xmax <span class="op">=</span> <span class="va">max_week</span> <span class="op">+</span> <span class="fl">.5</span>,</span>
<span>    ymin <span class="op">=</span> <span class="op">-</span><span class="fl">0.005</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="st">"#f4f4f9"</span>,</span>
<span>  color <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>They set some additional aesthetic properties specific to this geom: <code>xmin</code>, <code>xmax</code>, <code>ymin</code>, and <code>ymax</code>, which determine the boundaries of the rectangle it produces. The result is a gray background drawn behind each small multiple, as shown in <a href="#fig-drought-viz-theme-tweaks-plot" class="quarto-xref">Figure&nbsp;<span>2.16</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-drought-viz-theme-tweaks-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-drought-viz-theme-tweaks-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-drought-viz-theme-tweaks-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-drought-viz-theme-tweaks-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.16: Faceted version of the drought visualization with gray backgrounds behind each small multiple
</figcaption></figure>
</div>
</div>
</div>
<p>Finally, consider the tweaks made to the legend. We previously saw a simplified version of the <code><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d()</a></code> function. Here is a more complete version:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span></span>
<span>  option <span class="op">=</span> <span class="st">"rocket"</span>,</span>
<span>  direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"Category:"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Abnormally Dry"</span>,</span>
<span>    <span class="st">"Moderate Drought"</span>,</span>
<span>    <span class="st">"Severe Drought"</span>,</span>
<span>    <span class="st">"Extreme Drought"</span>,</span>
<span>    <span class="st">"Exceptional Drought"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>name</code> argument sets the legend title, and the labels argument determines the <code>labels</code> that show up in the legend. <a href="#fig-drought-viz-legend-tweaks" class="quarto-xref">Figure&nbsp;<span>2.17</span></a> shows the result of these changes.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-drought-viz-legend-tweaks" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-drought-viz-legend-tweaks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data-viz_files/figure-html/fig-drought-viz-legend-tweaks-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-drought-viz-legend-tweaks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.17: Drought visualization with changes made to the legend text
</figcaption></figure>
</div>
</div>
</div>
<p>Rather than D0, D1, D2, D3, and D4, we now have the legend text Abnormally Dry, Moderate Drought, Severe Drought, Extreme Drought, and Exceptional Drought.</p>
</section><section id="the-complete-visualization-code" class="level3"><h3 class="anchored" data-anchor-id="the-complete-visualization-code">The Complete Visualization Code</h3>
<p>While I’ve showed you a nearly complete version of the code that Scherer and Karamanis wrote, I made some small changes to make it easier to understand. If you’re curious, the full code is here:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dm_perc_cat_hubs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">week</span>, <span class="va">percentage</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      xmax <span class="op">=</span> <span class="va">max_week</span> <span class="op">+</span> <span class="fl">.5</span>,</span>
<span>      ymin <span class="op">=</span> <span class="op">-</span><span class="fl">0.005</span>,</span>
<span>      ymax <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#f4f4f9"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="va">category</span>,</span>
<span>      fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_scale</a></span><span class="op">(</span><span class="fu">addmix</span><span class="op">(</span></span>
<span>        <span class="fu">darken</span><span class="op">(</span></span>
<span>          <span class="va">fill</span>,</span>
<span>          <span class="fl">.05</span>,</span>
<span>          space <span class="op">=</span> <span class="st">"HLS"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"#d8005a"</span>,</span>
<span>        <span class="fl">.15</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>      color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_scale</a></span><span class="op">(</span><span class="fu">darken</span><span class="op">(</span></span>
<span>        <span class="va">fill</span>,</span>
<span>        <span class="fl">.2</span>,</span>
<span>        space <span class="op">=</span> <span class="st">"HLS"</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">.9</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.12</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span></span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">hub</span><span class="op">)</span>,</span>
<span>    switch <span class="op">=</span> <span class="st">"y"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.02</span>, <span class="fl">.02</span><span class="op">)</span>,</span>
<span>    guide <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>    labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span></span>
<span>    option <span class="op">=</span> <span class="st">"rocket"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Category:"</span>,</span>
<span>    direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>    begin <span class="op">=</span> <span class="fl">.17</span>,</span>
<span>    end <span class="op">=</span> <span class="fl">.97</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Abnormally Dry"</span>,</span>
<span>      <span class="st">"Moderate Drought"</span>,</span>
<span>      <span class="st">"Severe Drought"</span>,</span>
<span>      <span class="st">"Extreme Drought"</span>,</span>
<span>      <span class="st">"Exceptional Drought"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span></span>
<span>    nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">18</span>,</span>
<span>    base_family <span class="op">=</span> <span class="st">"Roboto"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      family <span class="op">=</span> <span class="st">"Roboto Mono"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">11</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">.2</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">.2</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.ticks.length.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"#2DAADA"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">18</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"#2DAADA"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">16</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">20</span>, b <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.y.left <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">18</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.spacing.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    panel.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span>,</span>
<span>    plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">.4</span></span>
<span>    <span class="op">)</span>,</span>
<span>    plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a few additional tweaks to colors and spacing, but most of the code reflects what you’ve seen so far.</p>
</section></section><section id="in-conclusion-ggplot-is-your-data-visualization-secret-weapon" class="level2"><h2 class="anchored" data-anchor-id="in-conclusion-ggplot-is-your-data-visualization-secret-weapon">In Conclusion: ggplot is Your Data Visualization Secret Weapon</h2>
<p>You may start to think of ggplot as a solution to all of your data visualization problems. And yes, you have a new hammer, but no, everything is not a nail. If you look at the version of the data visualization that appeared in <em>Scientific American</em> in November 2021, you’ll see that some of its annotations aren’t visible in our recreation. That’s because they were added in post-production. While you could have found ways to create them in ggplot, it’s often not the best use of your time. Get yourself 90 percent of the way there with ggplot and then use Illustrator, Figma, or a similar tool to finish your work.</p>
<p>Even so, ggplot is a very powerful hammer, used to make plots that you’ve seen in <em>The New York Times</em>, FiveThirtyEight, the BBC, and other well-known news outlets. Although not the only tool that can generate high-quality data visualization, it makes the process straightforward. The graph by Scherer and Karamanis shows this in several ways:</p>
<ul>
<li><p><strong>It strips away extraneous elements, such as grid lines, to keep the focus on the data itself</strong>. Complete themes such as <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light()</a></code> and the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> function allowed Scherer and Karamanis to create a decluttered visualization that communicates effectively.</p></li>
<li><p><strong>It uses well-chosen colors</strong>. The <code><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d()</a></code> function allowed them to create a color scheme that demonstrates differences between groups, is colorblind friendly, and shows up well when printed in grayscale.</p></li>
<li><p><strong>It uses small multiples to break data from two decades and eight regions into a set of graphs that come together to create a single plot</strong>. With a single call to the <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> function, Scherer and Karamanis created over 100 small multiples that the tool automatically combined into a single plot.</p></li>
</ul>
<p>Learning to create data visualization in ggplot involves a significant time investment. But the long-term payoff is even greater. Once you learn how ggplot works, you can look at others’ code and learn how to improve your own. By contrast, when you make a data visualization in Excel, the series of point-and-click steps disappears into the ether. To recreate a visualization you made last week, you’ll need to remember the exact steps you used, and to make someone else’s data visualization, you’ll need them to write up their process for you.</p>
<p>Because code-based data visualization tools allow you to keep that record of the steps you made, you don’t have to be the most talented designer to make high-quality data visualization with ggplot. You can study others’ code, adapt it to your own needs, and create your own data visualization that is beautiful and communicates effectively.</p>
</section><section id="learn-more" class="level2"><h2 class="anchored" data-anchor-id="learn-more">Learn More</h2>
<p>Consult the following resources to learn more about data visualization principles and the ggplot2 package:</p>
<p><em>Data Visualization: A Practical Introduction</em> by Kieran Healy (Princeton University Press, 2018), https://socviz.co</p>
<p><em>Fundamentals of Data Visualization</em> by Claus Wilke (O’Reilly Media, 2019). https://clauswilke.com/dataviz/</p>
<p><em>ggplot2: Elegant Graphics for Data Analysis</em> by Hadley Wickham, Danielle Navarro, and Thomas Lin Pedersen (Springer, Forthcoming), https://ggplot2-book.org</p>
<p><em>Graphic Design with ggplot2</em> by Cédric Scherer (CRC Press, Forthcoming)</p>
<p>“The Glamour of Graphics,” course by Will Chase, https://rfortherestofus.com/courses/glamour/</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/book\.rfortherestofus\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./crash-course.html" class="pagination-link" aria-label="An R Programming Crash Course">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An R Programming Crash Course</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./custom-theme.html" class="pagination-link" aria-label="Custom Data Visualization Themes">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Custom Data Visualization Themes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>R for the Rest of Us: A Statistics-Free Introduction</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book can be purchased from No Starch Press.</p>
</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>